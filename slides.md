## Гарри Поттер

## и

## скриншотные тесты

NOTE: Всем привет. Поднимите руки кто знает что-нибудь про скриншотные тесты. А теперь те кто использует их у себя в проекте. Много народу: Круто что многие используют их, наверняка вы сталкивались с проблемами когда внедряли их, я кратко пробегусь по ним и то как их можно решить в конце расскажу какой путь выбралив контуре. Мало народу: Не густо, возможно у меня получится кого-нибудь из вас вдохновить внедрить к себе скриншотные тесты.

---

## Про себя

Фото и небольшое био

NOTE: Меня зовут Дима Лазарев. Я работаю в Контуре фронтендером 3.5 года. В данный момент работаю тимлидом в команде "Инфраструктура фронтенда"

---

## Инфраструктура фронтенда

Помощь командам в налаживании

- Тестирование
- Сборка
- Общие компоненты/библиотеки

NOTE: Чем занимается наша команда. Ну надеюсь по названию можно догадаться что мы делаем всякие инфраструктурные штуки во фронте. А именно помогаем командам с тестированием, стартом фронтовых проектов. Разрабатываем инструменты и библиотеки

---

## Контур.Гайды

NOTE: Переход к гайдам. Разрабатываем Дизайн систему для проетировщиков что-то там про создание интерфейсов

---

## react-ui

- Общие компоненты
- Используются в большинстве продуктах контура
- Высокие требования к качеству

NOTE: Общие компоненты в opensource реализованные согласно гайдам. Большинство команд используют их для создания интерфейса продуктов. Для нас как инфраструктурной команды важно уметь быстро выкатывать фичи в компонентах и не увеличивать кол-во багов. Это напрямую отражается на скорости выкатывания фич в продуктах и удовлетворенности пользователей. Поэтому мы используем у себя скриншотные тесты

---

## Скриншотные тесты

- Автоматизация тестирования верстки
- Проверка визуального отображения в разных браузерах

NOTE: Позволяют автоматизировать тестирование верстки в разных браузерах

---

## Проблемы скриншотных тестов

- чувствительны к окружению
- тяжело поддерживать
- нет коробочного решения

NOTE: Я подробно на каждом пункте остановлюсь и расскажу какие есть варианты решения той или иной проблемы

---

## Чувствительность к окружению

- Браузер и версии
- Шрифты
- ОС и настройки ОС
- Видеокарта
- Фаза луны, настроение тестировщика и тд

NOTE: Картинка с бордерами из твиттера. Короче всё сложно. Как это порешать.

---

## Всегда гонять на одной тачке

- Не распараллелить
- Тяжело дебажить
- Без CI :( Или с CI, но commit-push-testing

---

## Сохранять html как эталон

- Кроме html надо сохранять ещё css
- А ещё и состояние полей ввода
- И ховер
- И скролл

---

## Сравнивать прод и дев

- В два раза больше времени или ресурсов

---

## Virtual Machine To the Rescue

- Пул агентов
- Докер

---

## Тяжело поддерживать

- Обычно скриншотные тесты как дополнение к e2e
- Или тестирование конечного отображения сервиса

NOTE: Почему это тяжело, медленно и избыточно

---

## Тестировать компоненты изолированно

- Использовать storybook

---

## Нет коробочного решения

- Куча разных библиотек и фреймворков каждая со своими особенностями

- Gemini/hermione
- Jest-image-snapshot
- webdriverio
- puppeter
- Pixelmatch
- Сервисы

NOTE: расписать под каждое решение

---

## Как мы написали своё решение

- Изначально использовали gemini + sauce labs
- Всё было хорошо до определенного момента

---

## Минусы gemini

- Старый webdriver
- Зависимость от windows-build-tools
- Неудобный дифф
- Медленный
- Нет TypeScript
- Задеприкейчен

---

## Альтернатива Hermione

- Ничуть не лучше
- Всё тоже самое, только может ведбрайвер чуть посвежее
- И API в профиль

NOTE: Mocha как парсер тестов WUT?

---

## Причем тут Гарри

- Hermione вызывает ассоциации со вселенной Гарри Поттера
- Так как мы делаем своё решение возможно есть что-то что подойдет в качестве названия

---

Фотка Creevey

---

## Colin Creevey

- Мелкий пацан который постоянно тусовался с фотиком и пытался зафотать гарри
- А мы как раз хотим фотать скриншоты наших компонентов
- Кажется подходить идеально

---

## Требования

- Интеграция со Storybook
- TypeScript
- 

---

## Основные фичи

- Storybook
- TypeScript
- Легкий старт
- TypeScript
- Удобный diff

---

## Как заюзать

- npm install
- Edit config
- npx creevey --ui

---

## Скриншоты/гифки

---

## Не без минусов

- проект в MVP
- Необходим Selenium
- Нет поддержки puppeteer
- Нет некоторых хотелок

---

## Как Creevey помогает Контуру

- Скриншотим продуктовые сторисы
- Интеграционные тесты на контролы

---

## План развития

- Docker + puppeteer
- Framework agnostic
- Storybook addon (tests inside storybook)

---

## CTA

- Встраивайте скриншотные тесты себе
- Можете попробовать
- Приходите контрибьютить